<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ניהול מוצרים - Amazon Affiliate</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .manage-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .add-product-form {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .add-product-form input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        .add-product-form input:focus {
            outline: none;
            border-color: #667eea;
        }
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
        }
        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        .file-upload {
            margin: 1rem 0;
        }
        .file-upload input[type="file"] {
            display: none;
        }
        .file-upload-label {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: #667eea;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .file-upload-label:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <i class="fas fa-shopping-bag"></i>
                <span>Amazon Products</span>
            </div>
            <ul class="nav-menu">
                <li><a href="/">בית</a></li>
                <li><a href="/products">מוצרים</a></li>
                <li><a href="/manage" class="active">ניהול מוצרים</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <h1 style="text-align: center; color: white; margin: 2rem 0;">ניהול מוצרים</h1>
            
            <div class="manage-section">
                <h2><i class="fas fa-plus-circle"></i> הוספת מוצר חדש</h2>
                <p style="margin-bottom: 1rem; color: #666;">
                    <i class="fas fa-info-circle"></i> 
                    ניתן להוסיף מוצר באמצעות קישור רגיל או <strong>קישור שותפים (Affiliate Link)</strong>
                </p>
                
                <div style="margin-bottom: 1rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="radio" name="linkType" value="regular" checked onchange="updatePlaceholder()">
                        קישור רגיל
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="radio" name="linkType" value="affiliate" onchange="updatePlaceholder()">
                        קישור שותפים (Affiliate Link)
                    </label>
                </div>
                
                <div style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 5px;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">
                        <i class="fas fa-store"></i> חנות:
                    </label>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="radio" name="store" value="amazon" checked onchange="updatePlaceholder()">
                            <i class="fab fa-amazon" style="color: #FF9900;"></i> Amazon
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="radio" name="store" value="aliexpress" onchange="updatePlaceholder()">
                            <i class="fas fa-shopping-cart" style="color: #FF6A00;"></i> AliExpress
                        </label>
                    </div>
                    <small style="color: #666; display: block; margin-top: 0.5rem;">
                        <i class="fas fa-info-circle"></i> המערכת מזהה אוטומטית את החנות לפי הקישור
                    </small>
                </div>
                
                <div class="add-product-form">
                    <input type="text" id="productUrlInput" placeholder="הדבק קישור מוצר (Amazon או AliExpress)">
                    <button onclick="addProductFromUrl()" class="btn btn-primary">
                        <i class="fas fa-plus"></i> הוסף מוצר
                    </button>
                </div>
                <div id="addProductStatus"></div>
                
                <div style="margin-top: 1rem; padding: 1rem; background: #e8f4f8; border-radius: 5px; font-size: 0.9rem; border-right: 4px solid #667eea;">
                    <strong><i class="fas fa-lightbulb"></i> דוגמאות לקישורים:</strong><br><br>
                    
                    <strong><i class="fab fa-amazon" style="color: #FF9900;"></i> Amazon:</strong><br>
                    <code style="background: white; padding: 0.25rem 0.5rem; border-radius: 3px; display: inline-block; margin: 0.25rem 0;">
                        https://www.amazon.com/dp/B08N5WRWNW
                    </code><br>
                    <code style="background: white; padding: 0.25rem 0.5rem; border-radius: 3px; display: inline-block; margin: 0.25rem 0;">
                        https://www.amazon.com/dp/B08N5WRWNW?tag=your-tag-20
                    </code><br><br>
                    
                    <strong><i class="fas fa-shopping-cart" style="color: #FF6A00;"></i> AliExpress:</strong><br>
                    <code style="background: white; padding: 0.25rem 0.5rem; border-radius: 3px; display: inline-block; margin: 0.25rem 0;">
                        https://www.aliexpress.com/item/1234567890.html
                    </code><br>
                    <code style="background: white; padding: 0.25rem 0.5rem; border-radius: 3px; display: inline-block; margin: 0.25rem 0;">
                        https://www.aliexpress.com/item/1234567890.html?aff_platform=...
                    </code><br><br>
                    
                    <small style="color: #28a745;">
                        <i class="fas fa-check-circle"></i> המערכת מזהה אוטומטית את החנות וקישורי שותפים!
                    </small>
                </div>
            </div>

            <div class="manage-section">
                <h2><i class="fas fa-chart-bar"></i> סטטיסטיקות</h2>
                <div class="stats" id="stats">
                    <div class="stat-card">
                        <h3 id="totalProducts">0</h3>
                        <p>סה"כ מוצרים</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalVideos">0</h3>
                        <p>סרטונים שנוצרו</p>
                    </div>
                </div>
            </div>

            <div class="manage-section">
                <h2><i class="fas fa-upload"></i> ייבוא/ייצוא מוצרים</h2>
                <div class="action-buttons">
                    <div class="file-upload">
                        <label for="importFile" class="file-upload-label">
                            <i class="fas fa-upload"></i> ייבא מקובץ JSON
                        </label>
                        <input type="file" id="importFile" accept=".json" onchange="importProducts()">
                    </div>
                    <button onclick="exportProducts()" class="btn btn-secondary">
                        <i class="fas fa-download"></i> ייצא לקובץ JSON
                    </button>
                </div>
            </div>

            <div class="manage-section">
                <h2><i class="fas fa-list"></i> מוצרים שמורים</h2>
                <div style="margin-bottom: 1rem;">
                    <input type="text" id="searchSavedInput" placeholder="חפש במוצרים שמורים..." 
                           style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px;"
                           onkeyup="searchSavedProducts()">
                </div>
                <div class="loading" id="loadingSaved" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i> טוען מוצרים...
                </div>
                <div class="products-grid" id="savedProductsGrid">
                    <!-- Saved products will be loaded here -->
                </div>
            </div>
            
            <!-- Edit Product Modal -->
            <div id="editProductModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2><i class="fas fa-edit"></i> עריכת מוצר</h2>
                        <button onclick="closeEditModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
                    </div>
                    
                    <form id="editProductForm" onsubmit="saveProductEdit(event)">
                        <input type="hidden" id="editProductASIN">
                        
                        <div style="margin-bottom: 1rem;">
                            <label><strong>שם המוצר:</strong></label>
                            <input type="text" id="editProductTitle" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px; margin-top: 0.5rem;">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label><strong>תיאור (אנגלית):</strong></label>
                            <textarea id="editProductDescription" rows="4" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px; margin-top: 0.5rem; font-family: inherit;"></textarea>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <label><strong>תיאור בעברית:</strong></label>
                                <button type="button" onclick="translateDescription()" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                                    <i class="fas fa-language"></i> תרגם אוטומטית
                                </button>
                            </div>
                            <textarea id="editProductDescriptionHebrew" rows="4" placeholder="הזן תיאור בעברית או לחץ על 'תרגם אוטומטית'" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px; margin-top: 0.5rem; font-family: inherit; direction: rtl;"></textarea>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label><strong>תמונת מוצר (URL):</strong></label>
                            <input type="text" id="editProductImage" placeholder="https://..." style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px; margin-top: 0.5rem;">
                            <button type="button" onclick="document.getElementById('imageUploadInput').click()" class="btn btn-secondary" style="margin-top: 0.5rem;">
                                <i class="fas fa-upload"></i> העלה תמונה
                            </button>
                            <input type="file" id="imageUploadInput" accept="image/*" style="display: none;" onchange="uploadImage(event)">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label><strong>סרטון מוצר (URL):</strong></label>
                            <input type="text" id="editProductVideo" placeholder="https://..." style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px; margin-top: 0.5rem;">
                            <button type="button" onclick="document.getElementById('videoUploadInput').click()" class="btn btn-secondary" style="margin-top: 0.5rem;">
                                <i class="fas fa-upload"></i> העלה סרטון
                            </button>
                            <input type="file" id="videoUploadInput" accept="video/*" style="display: none;" onchange="uploadVideo(event)">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label><strong>מחיר (מאמזון):</strong></label>
                            <input type="text" id="editProductPrice" placeholder="$29.99" readonly style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px; margin-top: 0.5rem; background: #f5f5f5; cursor: not-allowed;">
                            <small style="color: #666; display: block; margin-top: 0.25rem;">המחיר המקורי של אמזון (לא ניתן לעריכה)</small>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label><strong>מחיר מקורי:</strong></label>
                            <input type="text" id="editProductOriginalPrice" placeholder="$39.99" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px; margin-top: 0.5rem;">
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">
                                <i class="fas fa-save"></i> שמור שינויים
                            </button>
                            <button type="button" onclick="closeEditModal()" class="btn btn-secondary" style="flex: 1;">
                                <i class="fas fa-times"></i> ביטול
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 Amazon Affiliate Showcase. כל הזכויות שמורות.</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/manage.js') }}"></script>
</body>
</html>
